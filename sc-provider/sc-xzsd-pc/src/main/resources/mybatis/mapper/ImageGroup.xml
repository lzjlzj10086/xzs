<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.demo.imagegroup.dao.ImageGroupDao">
    <select id="countSort" parameterType="com.demo.imagegroup.entity.ImageGroup" resultType="java.lang.Integer">
        select count(sort)
        from t_imagegroup
        where
        is_deleted = 0
        and
        sort = #{sort}
    </select>
    <insert id="addImageGroup" parameterType="com.demo.imagegroup.entity.ImageGroup">
        insert into t_imagegroup
        (
            sort,
            banner_code,
            image_url,
            start_time,
            stop_time,
            goods_code,
            status,
            is_deleted,
            create_time,
            create_user,
            update_time,
            update_user,
            version,
            title
        ) values
        (
            #{sort},
            #{bannerCode},
            #{imageUrl},
            #{startTime},
            #{stopTime},
            #{goodsCode},
            0,
            0,
            now(),
            #{userId},
            now(),
            #{userId},
            0,
            title
        );
    </insert>
    <select id="listGoodsByPage" parameterType="com.demo.goods.entity.Goods" resultType="com.demo.goods.entity.GoodsVo">
        select
        goods_code goodsCode,
        goods_name goodsName,
        firstlevel_name firstLevelName,
        goods_status goodsStatus,
        secondlevel_name secondLevelName,
        price,
        goods_notes goodsNotes
        from t_goods
        where is_deleted = 0
        and goods_status = 0
        <if test="goodsName != null and goodsName != ''">
            and goods_name like concat('%', #{goodsName}, "%")
        </if>
        <if test="goodsCode != null and goodsCode !=''">
            and goods_code = #{goodsCode}
        </if>
    </select>

    <select id="listImageGroupByPage" parameterType="com.demo.imagegroup.entity.ImageGroup" resultType="com.demo.imagegroup.entity.ImageGroup">
        select
            banner_code bannerCode,
            sort,
            image_url imageUrl,
            status,
            start_time startTime,
            stop_time stopTime
        from t_imagegroup
        where is_deleted = 0
        <if test="status != null and status != ''">
            and status = #{status}
        </if>
        order by sort asc
    </select>

    <delete id="deleteImageGroup" parameterType="com.demo.imagegroup.entity.ImageGroup">
        update t_imagegroup
        set
            is_deleted = 1,
            update_time = now(),
            version = version + 1
        where banner_code in
        <foreach collection="bannerCode" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>
    <delete id="startIamgeGroup" parameterType="com.demo.imagegroup.entity.ImageGroup">
        update t_imagegroup
        set
        status = 1,
        update_time = now(),
        version = version + 1
        where
        is_deleted = 0
        and banner_code in
        <foreach collection="bannerCode" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>
    <delete id="stopImageGroup" parameterType="com.demo.imagegroup.entity.ImageGroup">
        update t_imagegroup
        set
        status = 2,
        update_time = now(),
        version = version + 1
        where
        is_deleted = 0
        and banner_code in
        <foreach collection="bannerCode" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>
</mapper>